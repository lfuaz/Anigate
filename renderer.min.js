document.addEventListener("DOMContentLoaded",function(){var e=!1,t=!1,n="";let i=document.getElementById("saved-frame"),d=i.getContext("2d"),l=[],a=document.getElementById("cursor");document.getElementById("loop").addEventListener("click",function(){this.classList.toggle("active"),e=!e}),document.getElementsByClassName("space-bar")[0].addEventListener("click",function(){B({keyCode:32})}),document.getElementsByClassName("f6")[0].addEventListener("click",function(){B({keyCode:117})}),document.getElementById("ctrl-z").addEventListener("click",function(){B({keyCode:90,ctrlKey:!0})}),document.getElementById("eraser").addEventListener("click",function(){this.classList.toggle("active"),t=!t});let s=document.querySelector("#frame");s.width=window.innerWidth,s.height=window.innerHeight,s.onmousemove=function(e){var t=e||window.event;window.mouseX=t.clientX,window.mouseY=t.clientY,a.style.left=window.mouseX+"px",a.style.top=window.mouseY+"px"},s.onmouseleave=function(e){document.documentElement.style.setProperty("--radius-cursor","0px")},s.onmouseenter=function(e){document.documentElement.style.setProperty("--radius-cursor","15px")},s.addEventListener("touchmove",function(e){var t=e.touches[0],n=new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY});s.dispatchEvent(n)}),s.addEventListener("touchstart",function(e){var t=e.touches[0],n=new MouseEvent("mousedown",{clientX:t.clientX,clientY:t.clientY});s.dispatchEvent(n)}),s.addEventListener("touchend",function(e){var t=new MouseEvent("mouseup",{});s.dispatchEvent(t)}),window.addEventListener("resize",function(){s.width=window.innerWidth,s.height=window.innerHeight,w(s,0,0)});let r=s.getContext("2d");r.lineCap="round",r.lineWidth=15;let o=document.querySelector(".js-color-picker");o.addEventListener("change",e=>{r.strokeStyle=e.target.value,document.documentElement.style.setProperty("--color-cursor",`${r.strokeStyle}`)});let c=document.querySelector(".js-line-range");document.querySelector(".js-range-value"),c.addEventListener("input",e=>{let t=e.target.value;r.lineWidth=t,document.documentElement.style.setProperty("--radius-cursor",r.lineWidth+"px")});let m=0,u=0,h=!1,g=()=>{h=!1,l.length>25&&(console.log(!0),l=l.splice(-25,25)),l.push(r.getImageData(0,0,s.width,s.height))},v=e=>{h=!0,[m,u]=[e.offsetX,e.offsetY]},p=e=>{if(h){let n=e.offsetX,i=e.offsetY;r.beginPath(),!0==t?r.globalCompositeOperation="destination-out":r.globalCompositeOperation="source-over",r.moveTo(m,u),r.lineTo(n,i),r.stroke(),m=n,u=i}};s.addEventListener("mousedown",v),s.addEventListener("mousemove",p),s.addEventListener("mouseup",g),s.addEventListener("mouseout",g);let f=document.querySelector(".js-timeline"),E=()=>{if(t=!1,document.getElementById("eraser").classList.remove("active"),""==n){let e=s.toDataURL();y(e,"new"),document.querySelectorAll(".frame"),w(s),$()}else{let i=s.toDataURL(),d=document.getElementById(n),l=d.children[1];l.src=i,w(s),$(),n=""}};function y(e,t="new"){if("new"==t){let i=document.createElement("img");i.src=e;let d=document.createElement("div");d.classList.add("frame"),d.id=uuidv4();let l=document.createElement("i");l.addEventListener("click",function(){d.remove(),n=""}),l.classList.add("fas","fa-trash-alt"),d.appendChild(l),d.appendChild(i),(addFrame=document.createElement("div")).classList.add("add-frame"),addFrame.classList.add("fa-solid","fa-plus"),addFrame.addEventListener("click",L),d.appendChild(addFrame),f.appendChild(d)}if("customAdd"==t){let a=document.createElement("img");a.src=`${location.origin}/public/images/empty.png`,a.width=s.width,a.height=s.height;let r=document.createElement("div");r.classList.add("frame"),r.id=uuidv4();let o=document.createElement("i");o.addEventListener("click",function(){r.remove(),n=""}),o.classList.add("fas","fa-trash-alt"),r.appendChild(o),r.appendChild(a),(addFrame=document.createElement("div")).classList.add("add-frame"),addFrame.classList.add("fa-solid","fa-plus"),addFrame.addEventListener("click",L),r.appendChild(addFrame),document.getElementById(e.parentNodeId).after(r)}}function L(){y({parentNodeId:this.parentNode.id},"customAdd")}let $=()=>{r.clearRect(0,0,s.width,s.height)},w=e=>{let t=document.getElementById("saved-frame");t.width=window.innerWidth,t.height=window.innerHeight;let n=t.getContext("2d");n.drawImage(e,0,0,t.width,t.height)},C=()=>{let e=document.getElementById("saved-frame"),t=e.getContext("2d");t.clearRect(0,0,e.width,e.height)};document.getElementById("clear").addEventListener("click",function(){$(),C()});let k=e=>{$(),C();let t=e.target;"IMG"==t.nodeName&&(Array.from(t.classList).includes("js-timeline")||_(t),n=t.parentNode.id,r.drawImage(t,0,0),void 0!=t.parentNode.previousSibling.id&&d.drawImage(document.getElementById(t.parentNode.previousSibling.id).children[1],0,0,i.width,i.height))};f.addEventListener("click",k);let I=()=>{let t=document.querySelectorAll("img"),n=0,i=setInterval(()=>{n<t.length?($(),r.drawImage(t[n],0,0),_(t[n]),n++):e?n=0:clearInterval(i)},100)};function _(e){let t=document.querySelectorAll("img");t.forEach(e=>{e.classList.remove("playing")}),e.classList.add("playing")}let B=e=>{32===e.keyCode&&E(),117===e.keyCode&&($(),C(),I()),90==e.keyCode&&e.ctrlKey&&(l.pop(),l.length>0?r.putImageData(l[l.length-1],0,0):($(),l=[]))};window.addEventListener("keydown",B)});